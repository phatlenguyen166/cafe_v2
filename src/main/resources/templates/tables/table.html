<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Đặt bàn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script th:src="@{/js/table/table.js}" defer></script>
  </head>
  <body>
    <div
      layout:fragment="content"
      class="relative z-10 min-h-full flex justify-center w-full p-6"
    >
      <div class="w-full max-w-4xl bg-gray-100 rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold mb-4">Quản lý bán hàng</h2>

        <!-- Thông báo -->
        <div
          th:if="${successMessage}"
          class="mb-4 p-3 rounded bg-green-100 text-green-800 border border-green-300"
        >
          <span th:text="${successMessage}"></span>
        </div>
        <div
          th:if="${errorMessage}"
          class="mb-4 p-3 rounded bg-red-100 text-red-800 border border-red-300"
        >
          <span th:text="${errorMessage}"></span>
        </div>

        <!-- Grid bàn -->
        <div class="grid grid-cols-4 gap-2 mb-4">
          <div
            th:each="table : ${listTables}"
            th:classappend="${table.status.name() == 'AVAILABLE'} ? 'bg-white' : (${table.status.name() == 'OCCUPIED'} ? 'bg-gray-300' : 'bg-yellow-200')"
            class="table-item border border-gray-300 rounded flex items-center justify-center h-20 font-semibold text-center flex-col cursor-pointer relative"
            th:attr="data-id=${table.id},data-status=${table.status.name()}"
          >
            <span th:text="${table.tableName}">Bàn</span>
            <span
              class="text-xs font-normal"
              th:if="${table.status.name() == 'AVAILABLE'}"
              >&lt;trống&gt;</span
            >
            <span
              class="text-xs font-normal text-red-600"
              th:if="${table.status.name() == 'OCCUPIED'}"
              >Đang sử dụng</span
            >
            <span
              class="text-xs font-normal text-yellow-600"
              th:if="${table.status.name() == 'RESERVED'}"
              >Đã đặt trước</span
            >
            <!-- Dấu tích -->
            <span
              class="check-icon hidden absolute top-1 right-1 text-green-600"
            >
              &#10003;
            </span>
          </div>
        </div>
        <!-- Các nút chức năng -->
        <div class="flex flex-wrap gap-2 mb-2 items-center justify-center">
          <button
            class="px-4 py-1 rounded border font-semibold transition bg-blue-500 text-white border-blue-600 hover:bg-blue-600 hover:shadow disabled:bg-blue-200 disabled:text-blue-400 disabled:border-blue-200 disabled:cursor-not-allowed"
          >
            Xem bàn
          </button>
          <button
            id="openSwitchTableModal"
            class="px-4 py-1 rounded border font-semibold transition bg-yellow-500 text-white border-yellow-600 hover:bg-yellow-600 hover:shadow disabled:bg-yellow-200 disabled:text-yellow-400 disabled:border-yellow-200 disabled:cursor-not-allowed"
            disabled
          >
            Chuyển bàn
          </button>
          <button
            class="px-4 py-1 rounded border font-semibold transition bg-gray-200 text-gray-700 border-gray-400 hover:bg-gray-300 hover:shadow disabled:bg-gray-100 disabled:text-gray-400 disabled:border-gray-200 disabled:cursor-not-allowed"
          >
            Tách bàn
          </button>
          <button
            class="px-4 py-1 rounded border font-semibold transition bg-gray-200 text-gray-700 border-gray-400 hover:bg-gray-300 hover:shadow disabled:bg-gray-100 disabled:text-gray-400 disabled:border-gray-200 disabled:cursor-not-allowed"
          >
            Gộp bàn
          </button>
          <button
            id="cancelTableBtn"
            class="px-4 py-1 rounded border font-semibold transition bg-red-500 text-white border-red-600 hover:bg-red-600 hover:shadow disabled:bg-red-200 disabled:text-red-400 disabled:border-red-200 disabled:cursor-not-allowed"
            disabled
          >
            Hủy bàn
          </button>
          <button
            id="openBookingModal"
            class="px-4 py-1 rounded border font-semibold transition bg-green-500 text-white border-green-600 hover:bg-green-600 hover:shadow disabled:bg-green-200 disabled:text-green-400 disabled:border-green-200 disabled:cursor-not-allowed"
            disabled
          >
            Đặt bàn
          </button>
        </div>
        <div class="flex flex-wrap gap-2 justify-center items-center">
          <button class="px-4 py-1 bg-gray-200 rounded border border-gray-400">
            Chọn thực đơn......
          </button>
          <button class="px-4 py-1 bg-gray-200 rounded border border-gray-400">
            Thanh toán.....
          </button>
          <button class="px-4 py-1 bg-gray-200 rounded border border-gray-400">
            In ấn.....
          </button>
        </div>
      </div>

      <!-- Modal chuyển bàn -->
      <div
        id="switchTableModal"
        class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
      >
        <div class="bg-white rounded shadow-lg p-6 min-w-[350px]">
          <div class="mb-4 font-semibold text-base">
            Chuyển bàn <span id="switchFromTableName"></span>
          </div>
          <form
            id="switchTableForm"
            method="post"
            th:action="@{/sale/switch-table}"
          >
            <input type="hidden" name="fromTableId" id="fromTableIdInput" />
            <label class="block mb-3">
              Chọn bàn cần chuyển đến:
              <select
                name="toTableId"
                id="toTableIdInput"
                class="border rounded px-2 py-1 w-full"
                required
              >
                <option value="" disabled selected>-- Chọn bàn --</option>
                <option
                  th:each="table : ${listTables}"
                  th:value="${table.id}"
                  th:text="${table.tableName}"
                  th:if="${table.status.name() == 'AVAILABLE'}"
                ></option>
              </select>
            </label>
            <div class="flex gap-2 justify-center mt-4">
              <button
                type="submit"
                class="bg-blue-500 text-white px-4 py-1 rounded font-semibold border border-blue-600 transition hover:bg-blue-600 hover:shadow"
              >
                Chuyển
              </button>
              <button
                type="button"
                id="closeSwitchTableModal"
                class="bg-gray-300 px-4 py-1 rounded font-semibold border border-gray-400 transition hover:bg-gray-400 hover:shadow"
              >
                Hủy
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- End modal chuyển bàn -->

      <!-- Modal Đặt bàn  -->
      <div
        id="bookingModal"
        class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden"
      >
        <div class="bg-white rounded shadow-lg p-6 min-w-[400px]">
          <div class="mb-4 font-semibold text-base" id="modalTableName">
            Đặt bàn
          </div>
          <form
            id="bookingForm"
            class="space-y-3"
            method="post"
            th:action="@{/sale/create-table}"
            novalidate
          >
            <input type="hidden" name="tableId" id="tableIdInput" />
            <input
              type="hidden"
              name="reservationDate"
              id="reservationDateInput"
            />
            <div class="flex gap-2">
              <label class="flex-1">
                Khách hàng:
                <input
                  type="text"
                  class="border rounded px-2 py-1 w-full"
                  name="customerName"
                  id="customerNameInput"
                  required
                />
                <div
                  id="customerNameError"
                  class="text-red-600 text-sm mt-1"
                ></div>
              </label>
              <label class="flex-1">
                SĐT:
                <input
                  type="text"
                  class="border rounded px-2 py-1 w-full"
                  name="customerPhone"
                  id="customerPhoneInput"
                  required
                />
                <div
                  id="customerPhoneError"
                  class="text-red-600 text-sm mt-1"
                ></div>
              </label>
            </div>
            <div class="flex gap-2">
              <label class="flex-1">
                Ngày:
                <input
                  type="date"
                  class="border rounded px-2 py-1 w-full"
                  name="date"
                  id="dateInput"
                  required
                />
                <div id="dateError" class="text-red-600 text-sm mt-1"></div>
              </label>
              <label class="flex-1">
                Giờ:
                <input
                  type="time"
                  class="border rounded px-2 py-1 w-full"
                  name="time"
                  id="timeInput"
                  required
                />
                <div id="timeError" class="text-red-600 text-sm mt-1"></div>
              </label>
            </div>
            <!-- Nút trong modal -->
            <div class="flex gap-2 justify-center mt-4">
              <button
                type="submit"
                class="bg-blue-500 text-white px-4 py-1 rounded font-semibold border border-blue-600 transition hover:bg-blue-600 hover:shadow disabled:bg-blue-200 disabled:text-blue-400 disabled:border-blue-200 disabled:cursor-not-allowed"
              >
                Đặt bàn
              </button>
              <button
                type="button"
                id="closeBookingModal"
                class="bg-gray-300 px-4 py-1 rounded font-semibold border border-gray-400 transition hover:bg-gray-400 hover:shadow"
              >
                Hủy
              </button>
            </div>
          </form>
        </div>
      </div>
      <!-- End Modal đặt bàn  -->

      <!-- Form hủy bàn  -->
      <form
        id="cancelTableForm"
        method="post"
        th:action="@{/sale/cancel-table}"
        style="display: none"
      >
        <input type="hidden" name="tableId" id="cancelTableIdInput" />
      </form>
      <!-- End form đặt bàn  -->
    </div>
  </body>
</html>
